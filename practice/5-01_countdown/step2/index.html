<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>テンプレート</title>
  <link href="../../../_common/images/favicon.ico" rel="shortcut icon">
  <link href="https://fonts.googleapis.com/css?family=M+PLUS+1p:400,500" rel="stylesheet">
  <link href="../../../_common/css/style.css" rel="stylesheet">
</head>

<body>
  <header>
    <div class="container">
      <h1>タイトル</h1>
      <h2>サブタイトル</h2>
    </div><!-- /.container -->
  </header>
  <main>
    <div class="container">
      <section>
        <p>今から<span id="timer"></span>以内に注文すると50%オフ！</p>
      </section>
    </div><!-- /.container -->
  </main>
  <footer>
    <div class="container">
      <p>JavaScript Samples</p>
    </div><!-- /.container -->
  </footer>

  <script>
    'use strict';

    function countdown(due) {
      // 現在日時を取得
      const now = new Date();

      // 未来の時刻（ミリ秒） - 現在の時刻（ミリ秒） = 残り時間の取得（ミリ秒）
      const rest = due.getTime() - now.getTime();

      // 秒を取得（1分 = 60秒なので、1分 = 60秒の塊の余りが秒数になる）
      const sec = Math.floor(rest / 1000) % 60;
      // 分を取得（1時間 = 60分なので、1時間 = 60分の塊の余りが分数になる）
      const min = Math.floor(rest / 1000 / 60) % 60;
      // 時を取得（1日 = 24時間なので、1日 = 24時間の塊の余りが時数になる）
      const hour = Math.floor(rest / 1000 / 60 / 60) % 24;
      // 日を取得
      const days = Math.floor(rest / 1000 / 60 / 60 / 24);

      const count = [days, hour, min, sec];

      return count;
    }

    // 現在日時でオブジェクトを取得
    let goal = new Date();
    // 時、分、秒を未来の時間に設定（年、月、日 は new Date() でページを開いた日になる）
    goal.setHours(23);
    goal.setMinutes(59);
    goal.setSeconds(59);

    function recalc() {
      // 残り時間を取得して画面に表示
      const counter = countdown(goal);
      // テンプレート文字列を使って○時間△分□秒のテキストを作成
      const time = `${counter[1]}時間${counter[2]}分${counter[3]}秒`;
      // テキストコンテンツを出力
      document.getElementById('timer').textContent = time;
      // 関数呼び出し
      refresh();
    }

    function refresh() {
      // setTimeoutは、指定した時間後に一度だけ動作する
      // recalc()とはしない！！
      setTimeout(recalc(), 1000);
    }

    recalc();
  </script>
</body>

</html>
